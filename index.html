<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regístrate Aquí</title>
    <!-- Carga de Tailwind CSS para un diseño rápido y moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración para usar la fuente Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; 
        }
        
        /* Colores base y ajustes de la marca */
        :root {
            --form-bg-light-gray: #f2f4f8; 
            --brand-blue: #0d6efd; 
        }

        /* Estilos de enfoque para inputs */
        .input-field {
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .input-field:focus {
            border-color: var(--brand-blue); 
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
            transform: translateY(-1px);
        }
        /* Estilos del botón de envío */
        .submit-button {
            transition: all 0.3s ease;
            background-color: var(--brand-blue); 
        }
        .submit-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-color: #0b5ed7; 
        }
        .submit-button:disabled {
            background-color: #6ea8fe; 
            cursor: not-allowed;
        }
        
        /* Fondo con degradado: Verde Agua a Celeste */
        .hero-background {
            background: linear-gradient(135deg, #a8e0f0 0%, #b3e0ff 100%); 
        }
        
        /* Estilo del contenedor del formulario: Gris Claro */
        .form-container {
            background-color: var(--form-bg-light-gray);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col justify-between items-center p-4 sm:p-8 hero-background">

    <!-- Contenedor Principal del Formulario -->
    <main class="w-full max-w-lg mx-auto my-10">
        <div class="form-container p-6 sm:p-10 rounded-xl shadow-2xl border border-gray-300">
            <h1 class="text-3xl font-extrabold text-gray-800 mb-2 text-center">Regístrate Aquí</h1>
            <p class="text-gray-600 mb-8 text-center">Completa tus datos</p>

            <form id="registrationForm" class="space-y-6">

                <!-- Campo Nombre -->
                <div>
                    <label for="nombre" class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo <span class="text-red-500">*</span></label>
                    <input type="text" id="nombre" name="Nombre" required
                           class="input-field w-full p-3 border border-gray-300 rounded-lg focus:outline-none"
                           placeholder="Tu nombre y apellido">
                </div>

                <!-- Campo Organización (Opcional) -->
                <div>
                    <label for="organizacion" class="block text-sm font-medium text-gray-700 mb-1">Organización / Empresa</label>
                    <input type="text" id="organizacion" name="Organizacion"
                           class="input-field w-full p-3 border border-gray-300 rounded-lg focus:outline-none"
                           placeholder="El nombre de tu empresa (opcional)">
                </div>

                <!-- Campo Correo -->
                <div>
                    <label for="correo" class="block text-sm font-medium text-gray-700 mb-1">Correo Electrónico <span class="text-red-500">*</span></label>
                    <input type="email" id="correo" name="Correo" required
                           class="input-field w-full p-3 border border-gray-300 rounded-lg focus:outline-none"
                           placeholder="ejemplo@dominio.cl">
                    <p id="emailError" class="text-xs text-red-500 mt-1 hidden">Por favor, ingresa un correo electrónico válido.</p>
                </div>

                <!-- Campo Teléfono (Opcional) -->
                <div>
                    <label for="telefono" class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                    <input type="tel" id="telefono" name="Telefono"
                           class="input-field w-full p-3 border border-gray-300 rounded-lg focus:outline-none"
                           placeholder="+56 9 1234 5678 (opcional)">
                </div>
                
                <!-- Nuevo Campo Instagram (Opcional) -->
                <div>
                    <label for="instagram" class="block text-sm font-medium text-gray-700 mb-1">Instagram</label>
                    <input type="text" id="instagram" name="Instagram"
                           class="input-field w-full p-3 border border-gray-300 rounded-lg focus:outline-none"
                           placeholder="@tunombredeusuario">
                </div>

                <!-- Área de Mensaje/Estado -->
                <div id="statusMessage" class="py-2 px-4 text-center rounded-lg font-medium hidden" role="status"></div>

                <!-- Botón de Envío -->
                <button type="submit" id="submitButton"
                         class="submit-button w-full flex items-center justify-center p-3 text-white rounded-lg font-semibold focus:outline-none focus:ring-4 focus-ring-brand-blue">
                    <span id="buttonText">Registrarse</span>
                    <div id="loadingSpinner" class="hidden ml-3 h-5 w-5 border-2 border-t-2 border-white rounded-full animate-spin"></div>
                </button>
            </form>
        </div>
    </main>

    <!-- Pie de Página (Footer) -->
    <footer class="w-full text-center py-4 text-gray-700 text-sm">
        &copy; 2024 Copyright Desarrollado por
        <a href="https://obenmedia.cl" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 font-medium transition duration-150 ease-in-out">
            obenmedia.cl
        </a>
    </footer>

    <!-- Script para el Manejo del Formulario y Envío a Google Sheets -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('registrationForm');
            const statusMessage = document.getElementById('statusMessage');
            const submitButton = document.getElementById('submitButton');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const telefonoInput = document.getElementById('telefono');
            const correoInput = document.getElementById('correo');

            // URL del Apps Script (la URL 'exec' que acepta POSTs)
            const GOOGLE_SHEET_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby_i2RXWN6J7zZn9jrpY26_tPH3prTYTr4HBy0WPdgP9-6KnfWxhL1bAvXlL1bp9pNLNw/exec'; 

            function showStatus(message, type = 'success') {
                statusMessage.textContent = message;
                statusMessage.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-blue-100', 'text-blue-800');
                if (type === 'success') {
                    statusMessage.classList.add('bg-green-100', 'text-green-800');
                } else if (type === 'error') {
                    statusMessage.classList.add('bg-red-100', 'text-red-800');
                } else { // Loading/Info
                    statusMessage.classList.add('bg-blue-100', 'text-blue-800');
                }
                statusMessage.classList.remove('hidden');
            }

            function setFormState(isLoading) {
                submitButton.disabled = isLoading;
                form.querySelectorAll('input, button').forEach(el => {
                    if (el !== submitButton) el.disabled = isLoading;
                });

                buttonText.textContent = isLoading ? 'Registrando...' : 'Registrarse';
                loadingSpinner.classList.toggle('hidden', !isLoading);
            }

            function validateForm() {
                let isValid = true;
                const nombreInput = document.getElementById('nombre');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const emailError = document.getElementById('emailError');

                // Validación de Nombre
                if (!nombreInput.value.trim()) {
                    nombreInput.classList.add('border-red-500');
                    isValid = false;
                } else {
                    nombreInput.classList.remove('border-red-500');
                }

                // Validación de Correo
                if (!correoInput.value.trim() || !emailRegex.test(correoInput.value.trim())) {
                    correoInput.classList.add('border-red-500');
                    emailError.classList.remove('hidden');
                    isValid = false;
                } else {
                    correoInput.classList.remove('border-red-500');
                    emailError.classList.add('hidden');
                }

                if (!isValid) {
                    showStatus('Por favor, completa los campos obligatorios correctamente.', 'error');
                }
                return isValid;
            }

            // Limpia el teléfono de caracteres no numéricos
            telefonoInput.addEventListener('input', () => {
                telefonoInput.value = telefonoInput.value.replace(/[^0-9+ ]/g, '');
            });
            
            // Quita la validación visual al escribir
            document.getElementById('nombre').addEventListener('input', () => {
                 document.getElementById('nombre').classList.remove('border-red-500');
            });
            correoInput.addEventListener('input', () => {
                 correoInput.classList.remove('border-red-500');
                 document.getElementById('emailError').classList.add('hidden');
            });


            form.addEventListener('submit', (event) => {
                event.preventDefault();

                if (!validateForm()) {
                    return; 
                }

                setFormState(true);
                showStatus('Procesando tu registro...', 'info');

                const formData = new FormData(form);

                // ------------------------------------------
                // FIX: ENVIAR FormData directamente. 
                // Esto permite que el navegador use Content-Type: multipart/form-data 
                // lo cual es más tolerado por Apps Script cross-origin.
                // IMPORTANTE: No se establece el Content-Type manualmente.
                // ------------------------------------------
                const xhr = new XMLHttpRequest();
                xhr.open('POST', GOOGLE_SHEET_WEB_APP_URL);
                
                xhr.onload = function() {
                    setFormState(false);
                    
                    // Si el servidor de Google responde, incluso con una redirección 302 (típica) o éxito 200, 
                    // asumimos que el script se ejecutó.
                    if (xhr.status === 200 || xhr.status === 302 || xhr.responseText.length === 0) {
                        showStatus('✅ ¡Registro exitoso! Gracias por registrarte.', 'success');
                        form.reset();
                    } else {
                        // Respuesta inesperada o error de servidor
                        showStatus(`❌ Error al registrar. Revisa la consola o tu Apps Script. (Status: ${xhr.status})`, 'error');
                        console.error("Respuesta de XHR:", xhr.responseText);
                    }
                };

                xhr.onerror = function() {
                    setFormState(false);
                    // Este es el error de red real, diferente al bloqueo CORS.
                    showStatus('❌ Error de red o fallo de conexión. Intenta de nuevo.', 'error');
                };

                // Enviar el objeto FormData directamente, permitiendo que el navegador establezca 
                // Content-Type: multipart/form-data con boundary.
                xhr.send(formData);
            });
        });
    </script>
</body>
</html>
